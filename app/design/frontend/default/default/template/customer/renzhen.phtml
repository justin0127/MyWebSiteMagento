<script>	  function getStrLen(){  var message=document.getElementById('message1').value;  //alert(message);  if(document.getElementById('message').value.length==null||document.getElementById('message').value.length<4){   document.getElementById('alertmsg').value="您输入的验证码少于4位或空";   return false;  }else{       if((document.getElementById('message').value)!=message){   document.getElementById('alertmsg').value="验证信息不正确，请重新获取或输入";   return false;   }else{     var exp = new Date();    exp.setTime(exp.getTime() - 1);    var cval=getCookie(mobile);    if(cval!=null) document.cookie= mobile + "="+cval+";expires="+exp.toGMTString();;	//alert(cval);	return true;	}  }    }    function   refreshopage(){      window.location.reload();}     function ClearInput(){   document.getElementById('alertmsg').value="";     }  //var n = 10//var tid = setTimeout("show()", 60*1000);//function show(){//if(tid != null) {clearTimeout(tid);tid = null;}//if(n==0) document.getElementById("btn1").style.display = "block";//else{n--;document.getElementById("pad").innerText = n;tid = setTimeout("show()", 100);}//function readload(){ // window.reload();</script><?php//随机一串字符串functionfunction genRandomString($len){    $chars = array(        "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k",         "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v",         "w", "x", "y", "z", "A", "B", "C", "D", "E", "F", "G",         "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R",         "S", "T", "U", "V", "W", "X", "Y", "Z", "0", "1", "2",         "3", "4", "5", "6", "7", "8", "9"    );    $charsLen = count($chars) - 1;    shuffle($chars);    // 将数组打乱    $output = "";    for ($i=0; $i<$len; $i++)    {        $output .= $chars[mt_rand(0, $charsLen)];    }    return $output;}	//调用随机生成的字符串 	//$content = genRandomString(4);//随机字符串?><?php//$duanxin = "/var/www/sisley/shell/sendsms.py -m '13917332170' -t '测试4'";//发送短信//shell_exec($duanxin);   //命令行输出//get customer idfunction getId(){$id = Mage::getModel('core/cookie')->get("id");   //magento get cookiereturn $id;}//get customer mobilefunction getMobile(){$mobile = Mage::getModel('core/cookie')->get("mobile");   //magento get cookiereturn $mobile;}//get customer namefunction getName(){$name = Mage::getModel('core/cookie')->get("name");   //magento get cookiereturn $name;}//调用name$_name = getName();//调用mobile$_mobile = getMobile();function getConfirm($_mobile,$content,$content1){//insert current content in backend customer's mobile$_customer_id = getId();$customer = Mage::getModel('customer/customer')->load($_customer_id);$customer->setMessage($content1);$customer->save();/*$curlPost['USER'] = 'btsm20';$curlPost['PWD'] = '123456';$curlPost['DESTMOBS'] = $_mobile;$curlPost['CONTENT'] = $content;$ch = curl_init();curl_setopt($ch, CURLOPT_URL, 'http://115.238.72.23/Interface_ReceiveMsg.aspx');curl_setopt($ch, CURLOPT_HEADER, 1);curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);curl_setopt($ch, CURLOPT_POST, 1);curl_setopt($ch, CURLOPT_POSTFIELDS, $curlPost);$data = curl_exec($ch);//var_dump($curlPost);curl_close($ch); */$dbname = (string)Mage::getConfig()->getNode('global/resources/default_setup/connection/dbname');$username = (string)Mage::getConfig()->getNode('global/resources/default_setup/connection/username');$password = (string)Mage::getConfig()->getNode('global/resources/default_setup/connection/password');$link = mysql_connect('localhost', $username, $password) or die('Not connected : ' . mysql_error());$db_selected = mysql_select_db($dbname, $link);$query = sprintf("insert into sisley_smslog(`destmobs`,`content`,`SendDate`) values('%s','%s',now())",			$_mobile,			$content);mysql_query($query); $mage_url = 'http://arvato.cosmocommerce.com/ws/sms.php?wsdl'; ini_set("soap.wsdl_cache_enabled", 0);$soap = new SoapClient( $mage_url ); $results = $soap->sendsms(array("DESTMOBS"=>$_mobile,"CONTENT"=>$content));Mage::log($results, null, date("Y-m-d")."-".'sms'.'.log');//echo '短信已发出';return;}//调试//var_dump($_mobile);   //1234567?><div class="renzhen">        <!-- First Send Message -->        <?php        $content1 = genRandomString(4);//get随机字符串        $content = '尊敬的希思黎会员，您的激活验证码为：'.$content1.'。请注意区分大小写。';//get随机字符串        getConfirm($_mobile,$content,$content1);        ?>        <!-- End First Send Message -->	<div class="renzhentit"><!--<h3>短信激活</h3>--></div>        <div class="renzhenName">		<b>亲爱的 <?php echo $_name; ?></b>,		</div>		<!-- we have already sent a message to your cell phone, which num is <?php //echo $_mobile; ?>.  -->		<div class="renzhenContain">		恭喜您！您的账户已激活成功。		<br >为了确保您的线上线下购物权益和积分的整合使用，我们要进行手机号码验证。		</br>		请查收并输入激活码以激活您的账号。		</div>		<!--  重新发送  -->		<div class="renzhenContain">		<span class="renzhenct">1分钟后可重新发送激活码</span>  <div id="pad"></div><button onclick="refreshopage() " type="submit" class="renzhenbutton left" id="btn1" disabled ><span id='secondsleft' s='60' ><?php echo $this->__('重新发送 (剩余60秒)') ?></span></button>		</div>		<!--  输入验证  -->		<div class="renzhenContain"><!--title="<?php //echo $this->__('Email Address') ?>"-->		<form action="http://www.sisley.com.cn/customer/account/loginPost/" method="post" onsubmit="getStrLen();return false;" >		<!-- Please Add Js To Check This Text Input Area -->		<?php		$customer_id = getId();		//var_dump($_email);		$customer = Mage::getModel('customer/customer')->load($customer_id);		//var_dump($customer);		?>		<span class="renzhenct">请输入激活码：</span><input type="text" name="message" id="message" value="<?php //echo $customer->getMessage(); ?>" title="<?php echo $this->__('Message') ?>" onfocus="JavaScript:ClearInput()"/>				<input type="hidden" id="offlinejh" name="offlinejh" value="<?php $today = date("Y-m-d H:i:s",time()+8*3600); echo $today;?>" />				<input type="hidden" name="message1" id="message1" value="<?php echo $customer->getMessage(); ?>" title="<?php echo $this->__('Message') ?>" disabled="disabled"/>		<input type="hidden" name="id" id="id" value="<?php echo $customer->getId(); ?>" title="<?php echo $this->__('Id') ?>"/> 		<input type="hidden" name="login[username]" value="<?php echo $customer->getEmail() ?>" id="email" class="input-text required-entry validate-email" title="<?php echo $this->__('Email Address') ?>" />		<input type="hidden" name="login[password]" value="<?php echo $customer->getPasswordHash() ?>" class="input-text required-entry validate-password" id="pass" title="<?php echo $this->__('Password') ?>" />								<input type="hidden" name="send" value="" id="send" title="<?php echo $this->__('send') ?>" />		<button type="submit" class="renzhenbutton1" ><span><span><?php echo $this->__('确定') ?></span></span></button>		<input type="text" id="alertmsg" value=""/>		<?php		//echo $customer->getConfirmation();		?>		</form>		</div>                                      </div><!-- use JS to delete the cookie when regirester refresh or reopen current page --><script>function enablebtn(){    var timeleft = jQuery('#secondsleft').attr('s');    if (timeleft > 0){                       jQuery('#secondsleft').attr('s', timeleft-1) ;            jQuery('#btn1').attr("disabled",true);             jQuery('#secondsleft').text('重新发送 (剩余'+ jQuery('#secondsleft').attr('s') + '秒)');            setTimeout("enablebtn()", 1000);                        }else{              jQuery('#secondsleft').text('重新发送');                     jQuery('#btn1').attr("disabled",false);              jQuery('#btn1').css("cursor",'pointer');                      }}setTimeout("enablebtn()", 0);</script><!-- end JS --><?php/*if($_POST['message']) {$confirm_mess = $_POST['message'];$already_mess = $customer->getMessage();  if($confirm_mess == $already_mess) {    echo 'You have been confirmed!';  }}*///?>